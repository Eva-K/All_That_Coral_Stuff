---
title: "CoralTypePrediction"
author: "Eva Kovacs"
date: "18/12/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## packages

```{r what you need }
install.packages("tidyverse")
install.packages("janitor")
install.packages("skimr")
install.packages("stringr")
install.packages("data.table")
install.packages("ggthemes")
install.packages("RColorBrewer")
install.packages("gmodels")
install.packages("dplyr")
install.packages("plyr")
install.packages("foreign")
install.packages("readr")
##install.packages('Rtools')
##install.packages('jwbannister/seepsVeg')


library(tidyverse) # use install.packages("tidyverse") if receive an error message
library(janitor) # use install.packages("janitor") if receive an error message
library(skimr)  # use install.packages("skimr") if receive an error message
library(stringr) # use install.packages("stringr") if receive an error message
library(data.table)
library(ggthemes)
library(RColorBrewer)
library(gmodels)
library(dplyr)
library(plyr)
library(foreign)
library(readr)

##library(Rtools)
##library(jwbannister/seepsVeg)

```


# Set the number of significant digits to preserve

```{r}

# Set
options(digits = 10)

#Check
options()

```

# Read in Files

```{r}
# Import file fom folder

head(CCMR_pred)

#  X1 Longitude Latitude pred.Bra pred.Mass pred.Plat
#  <dbl>     <dbl>    <dbl>    <dbl>     <dbl>     <dbl>
#1     1      146.    -17.8     36.2      64.4      5.06
```

# Rescale the values for each coral type (0-100)

```{r}
# Makea copy
CCMR <- CCMR_pred

# Change all negative prediction values to zero

setDT(CCMR)
for(j in grep('^pred', names(CCMR))){
 set(CCMR, i= which(CCMR[[j]]<0), j= j, value=0)
}

## Re-scale

# Calculate the SUM of the predicted coral types

CCMR<- CCMR%>%
  rowwise()%>%
  mutate(sum = sum(pred.Bra, pred.Mass, pred.Plat))

remove(CCMR_pred)

# Rescale the values

CCMR <- CCMR%>%
  rowwise()%>%
  mutate(Bra0100 = (100*(pred.Bra/sum)))

CCMR <- CCMR%>%
  rowwise()%>%
  mutate(Mass0100 = (100*(pred.Mass/sum)))

CCMR <- CCMR%>%
  rowwise()%>%
  mutate(Plat0100 = (100*(pred.Plat/sum)))

CCMR<- CCMR%>%
  rowwise()%>%
  mutate(sum2 = sum(Bra0100, Mass0100, Plat0100))

max(CCMR$sum2)
min(CCMR$sum2)

# Write to file

CCMRScaled <- write.csv(CCMR, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/CCMRScaled.csv")

```

# Calculate Dominant Coral Form (5%)

```{r 5% domiance}
CCMR <- CCMRScaled

CCMR <- mutate(CCMR, B = Bra0100)
CCMR <- mutate(CCMR, M = Mass0100)
CCMR <- mutate(CCMR, P = Plat0100)

#copy
CCMR2 <- CCMR

# recall
CCMR <- CCMR2

# calculate 5% dominance
CCMR <- CCMR%>%
  rowwise()%>%
  mutate(DomBy5 = fifelse((((B - M) >= 5) & ((B - P) >= 5)), "Branching", 
                          fifelse((((M - B) >= 5) & ((M - P) >= 5)), "Massive",
                         fifelse((((P - B) >=5) & ((P - M) >=5)), "Plate",
         
                         fifelse(((B <5) & (M == 0) & (P == 0)), "Branching",
                         fifelse(((M <5) & (B == 0) & (P == 0)), "Massive",
                         fifelse(((P <5) & (M == 0) & (B == 0)), "Plate", "Mixed")))))))
                         

unique(CCMR$DomBy5)


# Write to file

#RC_Mitch <- write.csv(RC_Mitch, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/Output/RC_Heron2018_DomBen.csv")


```

# 15% Dominance

```{r 15% dominance}

#copy
CCMR3 <- CCMR

# recall
CCMR <- CCMR3

# calculate 15% dominance
CCMR <- CCMR%>%
  rowwise()%>%
  mutate(DomBy15 = fifelse((((B - M) >= 15) & ((B - P) >= 15)), "Branching", 
                          fifelse((((M - B) >= 15) & ((M - P) >= 15)), "Massive",
                         fifelse((((P - B) >=15) & ((P - M) >=15)), "Plate",
         
                         fifelse(((B <15) & (M == 0) & (P == 0)), "Branching",
                         fifelse(((M <15) & (B == 0) & (P == 0)), "Massive",
                         fifelse(((P <15) & (M == 0) & (B == 0)), "Plate", "Mixed")))))))
                         

unique(CCMR$DomBy15)


```

# Just plain dominant

```{r Dominant by value}

#copy
CCMR4 <- CCMR

# recall
CCMR <- CCMR4

# calculate 15% dominance
CCMR <- CCMR%>%
  rowwise()%>%
  mutate(Dominant = fifelse(((B > M) & (B > P)), "Branching",
                            fifelse(((M > B)  & (M > P)), "Massive",
                                     fifelse(((P > B) & (P > M)), "Plate","None"))))

unique(CCMR$Dominant)

```

# Tidy and save

```{r select rows and save}

# select rows
CCMR <- CCMR %>%
  select("X1", "Longitude", "Latitude", "B":"Dominant")

# Write to csv
CCMR <- write.csv(CCMR, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/Output/CoralTypeMapping/CCMR_CT.csv")

```
# ##################
# ################## 
# Validation Points

# To extract any val points from the training points

```{r find the val points!}

####### To extract validation points
CCMR_Waves_val<- mutate(CCMR_Waves_val, Latitude=P_Lat)
CCMR_Waves_val<- mutate(CCMR_Waves_val, Longitude=P_Long)

CCMR_Val <- CCMR_Waves_val%>%
  select("Latitude":"Longitude")

# try to extract predictions for the val points 
# This shouldn't work as they weren't used for the modeling
# But some are pairing so delete those points

#CCMR_Valpreds <- merge(CCMR_Val, CCMR_simple, by=c("Longitude","Latitude"),all.x=TRUE, all.y=FALSE) 

CCMR_Valpreds <- left_join(CCMR_Val, CCMR_simple, by =c( "Longitude", "Latitude"))

# No CCMR val are joining - Yay

#######

```

# Create dominance for Validation

```{r Dominance val points}

CCMR_Waves_val <- mutate(CCMR_Waves_val, B = BrPerTot)
CCMR_Waves_val <- mutate(CCMR_Waves_val, M = MaPerTot)
CCMR_Waves_val <- mutate(CCMR_Waves_val, P = PPerTot)

#copy
CCMR <- CCMR_Waves_val%>%
  select("PeriPt", "Latitude":"P")

```

# Calculate Dominances

```{r 5%}

# calculate 5% dominance

CCMR <- CCMR%>%
  rowwise()%>%
  mutate(DomBy5 = fifelse((((B - M) >= 5) & ((B - P) >= 5)), "Branching", 
                          fifelse((((M - B) >= 5) & ((M - P) >= 5)), "Massive",
                         fifelse((((P - B) >=5) & ((P - M) >=5)), "Plate",
         
                         fifelse(((B <5) & (M == 0) & (P == 0)), "Branching",
                         fifelse(((M <5) & (B == 0) & (P == 0)), "Massive",
                         fifelse(((P <5) & (M == 0) & (B == 0)), "Plate", "Mixed")))))))
                         

unique(CCMR$DomBy5)
```


```{r 15%}

# calculate 15% dominance

CCMR <- CCMR%>%
  rowwise()%>%
  mutate(DomBy15 = fifelse((((B - M) >= 15) & ((B - P) >= 15)), "Branching", 
                          fifelse((((M - B) >= 15) & ((M - P) >= 15)), "Massive",
                         fifelse((((P - B) >=15) & ((P - M) >=15)), "Plate",
         
                         fifelse(((B <15) & (M == 0) & (P == 0)), "Branching",
                         fifelse(((M <15) & (B == 0) & (P == 0)), "Massive",
                         fifelse(((P <15) & (M == 0) & (B == 0)), "Plate", "Mixed")))))))
                         

unique(CCMR$DomBy15)
```


```{r 30%}

# calculate 30% dominance

CCMR <- CCMR%>%
  rowwise()%>%
  mutate(DomBy30 = fifelse((((B - M) >= 30) & ((B - P) >= 30)), "Branching", 
                          fifelse((((M - B) >= 30) & ((M - P) >= 30)), "Massive",
                         fifelse((((P - B) >=30) & ((P - M) >=30)), "Plate",
         
                         fifelse(((B <30) & (M == 0) & (P == 0)), "Branching",
                         fifelse(((M <30) & (B == 0) & (P == 0)), "Massive",
                         fifelse(((P <30) & (M == 0) & (B == 0)), "Plate", "Mixed")))))))
                         

unique(CCMR$DomBy30)
```

# Save

```{r}
CCMR <- write.csv(CCMR, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Wave_Predictions_per_region/Validation/CCMR_ValPts20210202.csv")
```

#Read in large DBF

```{r}

setwd("//sees-rsrc//Data/3DGBR_HabMap/Modelling/GEE_Output/Pixels_0-11")


# load the dbfs
dbf_paths <- list.files("CCMRCCMR25to10_cliptoSRSRS.dbf", full.names = T)
dbf_regions <- unlist(lapply(list.files("CCMR25to10_cliptoSRSRS.dbf"), function(x) strsplit(x, "_")[[1]][1]))
names(dbf_paths) <- dbf_regions
dbf_dfs <- mapply(load_dbf, dbf_paths, dbf_regions, SIMPLIFY = F)
dbf_dfs <- lapply(dbf_dfs, na.omit)

# alternate

CCMR <- read.dbf(system.file("CCMRCCMR25to10_cliptoSRSRS.dbf", package="foreign")[1])
str(x)
summary(x)


```

# Determine difference between CoralNet and ReefCLoud for CCMR

```{r}

# CoralNet CCMR output

CCMRct <- CCMR_Kalinda_Fleur_BENTHIC_DATA_submit_v2

CCMRtype <-
  CCMRct %>%
  rowwise()%>%
  mutate(
    Branching = (ACR_BRA + ACR_BRA_B_ + ACR_HIP + ACR_HIP_B_ + BRA_OTH + BRA_OTH_B_ +POCI+ POCI_B_ +POR_BRA+ POR_BRA_B_),
    Plate = (ACR_PE + ACR_PE_B_+ BRA_TAB_Ac+ BRA_TAB_B_ + TFP_RDG_Al +TFP_RDG_B_ +TFP_RND_Al +TFP_RND_B_),
    Massive = (BRA_DIG_Ac+ BRA_DIG_B_ +FAV_MUS +FAV_MUS_B_ +MASE_OTH +MASEoth_B_ + POR_ENC + POR_ENC_B_ + POR_MASS + POR_MAS_B_),
    Mixed = (ACR_OTH +ACR_OTH_B_+ OTH_HC+ OTH_HC_B_))

### For CR's kneejerk comparison
CCMRtype <- mutate(CCMRtype, Name = image_name)

summary_inference_2020June06_NoDups <- mutate(summary_inference_2020June06_NoDups, Name = image_name)

ReefCloud <- summary_inference_2020June06_NoDups %>%
  inner_join(CCMRtype, by = "Name")

# write file
 ReefCloud <- write.csv(ReefCloud, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/ReefCloudCCMR.csv")


#####
CCMRtype2 <-
  CCMRtype%>%
  select("Name", "Latitude", "Longitude", "Branching", "Massive", "Plate","Mixed")

print(count(CCMRtype2$Mixed))
print(count(CCMRtype2$Massive))
print(count(CCMRtype2$Branching))
print(count(CCMRtype2$Plate))

#CNb <- ggplot(CCMRtype2, aes(x=Branching)+
#                geom_histogram)

# ReefCloud CCMR output


CCMRrct <-summary_inference_2020June06_NoDups%>%
  select("image_name", "Branching","Massive","Plate")

CCMRrct <- mutate(CCMRrct, Name=image_name)
CCMRrct <-CCMRrct%>%
  select("Name", "Branching","Massive","Plate")
CCMRrct <- mutate(CCMRrct, BR=Branching)
CCMRrct <- mutate(CCMRrct, MA=Massive)
CCMRrct <- mutate(CCMRrct, PL=Plate)

CCMRrct <-CCMRrct%>%
  select("Name", "BR","MA","PL")

print(count(CCMRrct$Mixed))
print(count(CCMRrct$Massive))
print(count(CCMRrct$Branching))
print(count(CCMRrct$Plate))

ReefCloud <- CCMRrct
CoralNet <- CCMRtype2
# Compare the two outputs

Compare <- inner_join(ReefCloud, CoralNet, by = "Name")

# write file
 Compare <- write.csv(Compare, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/AnnotatonComparison.csv")

#facet_wrap(Zone~., nc=2)+
```

# Plot frequencies

```{r}

# ReefCloud
rcb <- hist(Compare$BR, main = "", xlab = "ReefCloud Branching")
rcm <- hist(Compare$MA, main = "", xlab = "ReefCloud Massive")
rcp <- hist(Compare$PL, main = "", xlab = "ReefCloud Plate")

# CoralNet
cnb <- hist(Compare$Branching, main = "", xlab = "CoralNet Branching")
cnm <- hist(Compare$Massive, main = "", xlab = "CoralNet Massive")
cnp <- hist(Compare$Plate, main = "", xlab = "CoralNet Plate")
cnx <- hist(Compare$Mixed, main = "", xlab = "CoralNet Mixed")

rm(CCMR_Kalinda_Fleur_BENTHIC_DATA_submit_v2)
rm(CCMRrct)
rm(CCMRctype)
rm(CCMRtype2)
rm(Compare)
rm(CoralNet)
rm(cnb)
rm(cnm)
rm(cnp)
rm(cnx)
rm(summary_inference_2020June06_NoDups)
rm(ReefCloud)
rm(rcb)
rm(rcm)
rm(rcp)

```

# ###########################################################
# Sort out CoralNet data for Mitch (coordinates and groupings)
# #############################################################

# SGBR June
```{r}
# Southern GBR June
# Copy data
SGBRJune <- X201906_SGBR

# Group data according to spreadsheet - Coral Type
SGBRJunetype <-
  SGBRJune %>%
  rowwise()%>%
  mutate( 
    Branching = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B`),
    Plate = (`ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B`),
    Massive = (`BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B`),
    Mixed = (`ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    CT_Oth = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `MINV_COTS` + `MOB-INV` + `OTH-SF` + `OTH-SF-B` + `OTH-SINV` + `Sand` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE` + `ALG_OTH` + `BMA_sand` + `CAL_CCA_DC` + `CAL_CCA_RB` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` + `EAM_DHC` + `EAM_RB` + `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin` + `Seagrass`))
    
SGBRJunetype <-
  SGBRJunetype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(SGBRJunetype)
unique(SGBRJunetype$CT_Tot)

# Group according to Benthic Type
SGBRJunetype <-
  SGBRJunetype %>%
  rowwise()%>%
  mutate( 
    HC = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B` + `ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B` + `BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B` + `ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    SC = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `OTH-SF` + `OTH-SF-B`),
    SD = (`Sand` + `BMA_sand`),
    RB = (`CAL_CCA_RB` + `EAM_RB`),
    RK = (`CAL_CCA_DC` + `EAM_DHC`),
    AL = (`ALG_OTH` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` +  `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin`),
    OT = (`MINV_COTS` + `MOB-INV`  + `OTH-SINV` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE`),
    SG = (`Seagrass`))
    
SGBRJunetype <-
  SGBRJunetype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(SGBRJunetype)
unique(SGBRJunetype$Ben_Tot)

# CLip the columns

SGBRJune_Mitch <- SGBRJunetype %>%
  select("Name", "Branching":"Ben_Tot")

# Add coordinates

SGBRJune_MitchCoords <- SGBRJune_Mitch%>%
  left_join(SGBR_transects2, by ="Name")

SGBRJune_MitchCoords <- SGBRJune_MitchCoords%>%
  select("Name", "Longitude","Latitude", "Branching":"Ben_Tot")

# write file
 SGBRJune_MitchCoords <- write.csv(SGBRJune_MitchCoords, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/SGBR201906.csv")

```

# SGBR ALL including Heron 2018

```{r Southern GBR ALL}
# Southern GBR ALL
# Read in data

# Group data according to spreadsheet - Coral Type
SGBRtype <-
  SGBRallwithCoords %>%
  rowwise()%>%
  mutate( 
    Branching = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B`),
    Plate = (`ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B`),
    Massive = (`BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B`),
    Mixed = (`ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    CT_Oth = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `MINV_COTS` + `MOB-INV` + `OTH-SF` + `OTH-SF-B` + `OTH-SINV` + `Sand` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE` + `ALG_OTH` + `BMA_sand` + `CAL_CCA_DC` + `CAL_CCA_RB` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` + `EAM_DHC` + `EAM_RB` + `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin` + `Seagrass`))
    
SGBRtype <-
  SGBRtype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(SGBRtype)
unique(SGBRtype$CT_Tot)

# Group according to Benthic Type
SGBRtype <-
  SGBRtype %>%
  rowwise()%>%
  mutate( 
    HC = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B` + `ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B` + `BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B` + `ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    SC = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `OTH-SF` + `OTH-SF-B`),
    SD = (`Sand` + `BMA_sand`),
    RB = (`CAL_CCA_RB` + `EAM_RB`),
    RK = (`CAL_CCA_DC` + `EAM_DHC`),
    AL = (`ALG_OTH` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` +  `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin`),
    OT = (`MINV_COTS` + `MOB-INV`  + `OTH-SINV` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE`),
    SG = (`Seagrass`))
    
SGBRtype <-
  SGBRtype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(SGBRtype)
unique(SGBRtype$Ben_Tot)

# CLip the columns

SGBR_Mitch <- SGBRtype %>%
  select("Name", "Longitude","Latitude", "Branching":"Ben_Tot")

# write file
 SGBR_Mitch <- write.csv(SGBR_Mitch, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/SGBRall_CT_ben.csv")

```

# CCMR

```{r}
# CCMR 
# add coordinates to Legacy
Legacy <- inner_join(percent_covers_Legacy,LegacyCoordinates, by ="Name")

# bind CCMR and Legacy
CCMRleg <- bind_rows(CCMR_Kalinda_Fleur_BENTHIC_DATA_submit_v2, Legacy)

# Copy data
CCMRct <- CCMRleg

CCMRtype <-
  CCMRct %>%
  rowwise()%>%
  mutate(
    Branching = (ACR_BRA + ACR_BRA_B_ + ACR_HIP + ACR_HIP_B_ + BRA_OTH + BRA_OTH_B_ +POCI+ POCI_B_ +POR_BRA+ POR_BRA_B_),
    Plate = (ACR_PE + ACR_PE_B_+ BRA_TAB_Ac+ BRA_TAB_B_ + TFP_RDG_Al +TFP_RDG_B_ +TFP_RND_Al +TFP_RND_B_),
    Massive = (BRA_DIG_Ac+ BRA_DIG_B_ +FAV_MUS +FAV_MUS_B_ +MASE_OTH +MASEoth_B_ + POR_ENC + POR_ENC_B_ + POR_MASS + POR_MAS_B_),
    Mixed = (ACR_OTH +ACR_OTH_B_+ OTH_HC+ OTH_HC_B_), 
    CT_Oth = (ALC_SF + ALC_SF_B_ + GORG  + GORG_B_ + MINV_COTS + MOB_INV + OTH_SF + OTH_SF_B_ + OTH_SINV + Sand + Other + F_TAPE + Unc + Unk + WATE + ALG_OTH + BMA_sand + CAL_CCA_DC + CAL_CCA_RB + Caul + Chlor + Cya_spe + Dicsp + EAM_DHC + EAM_RB + Lobph + MACR_Cal_H + MAECBS + Pad + Turbin + Seagrass))
    
CCMRtype <-
  CCMRtype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(CCMRtype)
unique(CCMRtype$CT_Tot)

# Group according to Benthic Type
CCMRtype <-
  CCMRtype %>%
  rowwise()%>%
  mutate( 
    HC = (ACR_BRA + ACR_BRA_B_ + ACR_HIP + ACR_HIP_B_ + BRA_OTH + BRA_OTH_B_ +POCI+ POCI_B_ +POR_BRA+ POR_BRA_B_ + ACR_PE + ACR_PE_B_+ BRA_TAB_Ac+ BRA_TAB_B_ + TFP_RDG_Al +TFP_RDG_B_ +TFP_RND_Al +TFP_RND_B_ + BRA_DIG_Ac+ BRA_DIG_B_ +FAV_MUS +FAV_MUS_B_ +MASE_OTH +MASEoth_B_ + POR_ENC + POR_ENC_B_ + POR_MASS + POR_MAS_B_ + ACR_OTH +ACR_OTH_B_+ OTH_HC+ OTH_HC_B_),
    SC = (ALC_SF + ALC_SF_B_ + GORG  + GORG_B_  + OTH_SF + OTH_SF_B_),
    SD = (Sand + BMA_sand),
    RB = (CAL_CCA_RB + EAM_RB),
    RK = (CAL_CCA_DC + EAM_DHC),
    AL = (ALG_OTH + Caul + Chlor + Cya_spe + Dicsp +  Lobph + MACR_Cal_H + MAECBS + Pad + Turbin),
    OT = (MINV_COTS + MOB_INV  + OTH_SINV + Other + F_TAPE + Unc + Unk + WATE),
    SG = (Seagrass))
    
CCMRtype <-
  CCMRtype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(CCMRtype)
unique(CCMRtype$Ben_Tot)

# Select columns

CCMR_Mitch <- CCMRtype %>%
  select("Name", "Latitude":"Ben_Tot")

# write file
 CCMR_Mitch <- write.csv(CCMR_Mitch, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/CCMRall_CT_ben.csv")

```

# FNGBR

```{r FNGBR}
# FNGBR
# Read in data

# Group data according to spreadsheet - Coral Type
FNGBRtype <-
  FNGBRwithCoords %>%
  rowwise()%>%
  mutate( 
    Branching = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B`),
    Plate = (`ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B`),
    Massive = (`BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B`),
    Mixed = (`ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    CT_Oth = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `MINV_COTS` + `MOB-INV` + `OTH-SF` + `OTH-SF-B` + `OTH-SINV` + `Sand` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE` + `ALG_OTH` + `BMA_sand` + `CAL_CCA_DC` + `CAL_CCA_RB` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` + `EAM_DHC` + `EAM_RB` + `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin` + `Seagrass`))
    
FNGBRtype <-
  FNGBRtype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(FNGBRtype)
unique(FNGBRtype$CT_Tot)

# Group according to Benthic Type
FNGBRtype <-
  FNGBRtype %>%
  rowwise()%>%
  mutate( 
    HC = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B` + `ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B` + `BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B` + `ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    SC = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `OTH-SF` + `OTH-SF-B`),
    SD = (`Sand` + `BMA_sand`),
    RB = (`CAL_CCA_RB` + `EAM_RB`),
    RK = (`CAL_CCA_DC` + `EAM_DHC`),
    AL = (`ALG_OTH` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` +  `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin`),
    OT = (`MINV_COTS` + `MOB-INV`  + `OTH-SINV` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE`),
    SG = (`Seagrass`))
    
FNGBRtype <-
  FNGBRtype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(FNGBRtype)
unique(FNGBRtype$Ben_Tot)

# CLip the columns

FNGBR_Mitch <- FNGBRtype %>%
  select("Name", "Longitude","Latitude", "Branching":"Ben_Tot")

# write file
 FNGBR_Mitch <- write.csv(FNGBR_Mitch, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/FNGBR_CT_ben.csv")

```

# ########################################################
# CAN'T DO THIS AS PPts REPEAT FOR EACH MANAGEMENT REGION
# Group data according to peripoint and summarise coral type for WGBR

```{r Peripoint to each image}

# WGBR

# Join datframes by "Name"

WGBR_CT <- inner_join(WholeGBR_images, WGBR_Th_FD_P_20190525, by = "Name")

# write to csv

#FNGBR_CT <- write.csv(FNGBR_CT, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/Output/JC/CT_total/FNGBR_PPts.csv")


```

# Summarise by PeriPoint

```{r Summarise by PeriPt}

# Count number of occurrences of each PeriPt and add that to the table

WGBR_PPt <- WGBR_CT %>%
  group_by(PeriPt)%>%
  dplyr::mutate(count = n())

colnames(WGBR_PPt)

WGBR_PPt <- select(WGBR_PPt, "Name":"Longitude", "Branching":"count")

# Summarise by PeriPt

# Calculate Total coral type points per zone
# when in doubt, add dplyr::

WGBR_TotPts <- WGBR_PPt %>%
  select("Name":"Longitude", "Branching":"CT_Oth" ,"PeriPt": "count")%>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotPts = count*100, TotBrpts = sum(Branching), TotMapts = sum(Massive), TotPpts = sum(Plate),  TotMix = sum(Mixed), TotOthPts = sum(CT_Oth))

colnames(WGBR_TotPts)

# Calculate fractional amount of coral types

WGBR_TotPts <- dplyr::mutate(WGBR_TotPts, BoverTot = (TotBrpts/TotPts), MoverTot = (TotMapts/TotPts), PoverTot = (TotPpts/TotPts), MixoverTot = (TotMix/TotPts))

colnames(WGBR_TotPts)

# Determine Dominant Coral Type per zone

WGBR_DomPerZone <- mutate(WGBR_TotPts, DomZone = ifelse((BoverTot == 0) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "None",
                                                           ifelse(((BoverTot) > (MoverTot)) & ((BoverTot) > (PoverTot)) & ((BoverTot) > (MixoverTot)),  "Branching",                                               
        ifelse(((MoverTot) > (BoverTot)) & ((MoverTot) > (PoverTot)) & ((MoverTot) > (MixoverTot)), "Massive", 
               ifelse(((PoverTot) > (BoverTot)) & ((PoverTot) > (MoverTot)) & ((PoverTot) > (MixoverTot)), "Plate", 
                      "Mixed")))))

unique(WGBR_DomPerZone$DomZone)

head(WGBR_DomPerZone)

colnames(WGBR_DomPerZone)

# write to file

WGBR_DomPerZone <- write.csv(WGBR_DomPerZone, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/WGBR_DomPerZone20210326.csv")


```

# Calculate percentage for dominant coral based on count per zone

```{r}

WGBRZone <- WGBR_DomPerZone20210326
colnames(WGBRZone)

# remove duplicated PeriPt rows
WGBRZone <- WGBRZone %>% distinct(PeriPt, .keep_all = TRUE)

# No Scaling ###################################

# Dominant CT by percentage with 5% difference

WGBRZone <- mutate(WGBRZone, DomByPer5 = if_else((BoverTot == 0) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "None",
                                                      if_else(((MoverTot - BoverTot) >=0.05) & ((MoverTot - PoverTot) >= 0.05) & ((MoverTot - MixoverTot) >= 0.05), "Massive",
                                                      if_else(((BoverTot - MoverTot) >=0.05) & ((BoverTot - PoverTot) >=0.05) & ((BoverTot - MixoverTot) >=0.05), "Branching",
                                                              if_else(((PoverTot - BoverTot) >=0.05) & ((PoverTot - MoverTot) >=0.05) & ((PoverTot - MixoverTot) >=0.05), "Plate", 
                                                                      if_else((BoverTot <0.05) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "Branching",
                                                                              if_else((MoverTot < 0.0005) & (BoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "Massive",
                                                                                      if_else((PoverTot < 0.0005) & (MoverTot == 0) & (BoverTot ==0) & (MixoverTot == 0), "Plate",
                                                                                              "Mixed"))))))))

unique(WGBRZone$DomByPer5)

# Dominant CT by percentage with 15% difference

WGBRZone <- mutate(WGBRZone, DomByPer15 = if_else((BoverTot == 0) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "None",
                                                      if_else(((MoverTot - BoverTot) >=0.15) & ((MoverTot - PoverTot) >= 0.15) & ((MoverTot - MixoverTot) >= 0.15), "Massive",
                                                      if_else(((BoverTot - MoverTot) >=0.15) & ((BoverTot - PoverTot) >=0.15) & ((BoverTot - MixoverTot) >=0.15), "Branching",
                                                              if_else(((PoverTot - BoverTot) >=0.15) & ((PoverTot - MoverTot) >=0.15) & ((PoverTot - MixoverTot) >=0.15), "Plate", 
                                                                      if_else((BoverTot <0.15) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "Branching",
                                                                              if_else((MoverTot < 0.0005) & (BoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "Massive",
                                                                                      if_else((PoverTot < 0.0005) & (MoverTot == 0) & (BoverTot ==0) & (MixoverTot == 0), "Plate",
                                                                                              "Mixed"))))))))

unique(WGBRZone$DomByPer15)

WGBRZone <- select(WGBRZone, "Name", "PeriPt":"P_Long", "Branching":"CT_Oth", "count":"DomByPer15")

# write to file

WGBRZone <- write.csv(WGBRZone, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/WGBRDomCTbyPercentage20210326.csv")


```
# ################################
# THIS IS WHAT NEEDS TO BE DONE

# Separate processing by management region to alleviate Ppt duplication issues
## Create spreadsheet for CCMR

```{r , echo=FALSE}
# Read CSV files from folder
CCMR <- CCMRall_CT_ben
# remove Legacy data
Leg <- LegacyCoordinates
# legacy data
legacy_CN <- semi_join(CCMR, Leg, by = "Name")
# CCMR data
CCMR_CN <- anti_join(CCMR, Leg, by = "Name")


# Make a copy
CCMR_CN <- CCMR_Kalinda_Fleur_BENTHIC_DATA_submit_v2

CCMR_CN <- CCMR_CN %>% dplyr::mutate(id = row_number())

# Make ID CCMR specific
CCMR_CN <- CCMR_CN %>% dplyr::mutate(Region = as.character("CCMR_"))

CCMR_CN <- CCMR_CN %>% unite("Pixel", Region:id, remove = FALSE)

```


# CCMR

```{r}
# CCMR 

CCMRtype <-
  CCMR_CN %>%
  rowwise()%>%
  mutate(
    Branching = (ACR_BRA + ACR_BRA_B_ + ACR_HIP + ACR_HIP_B_ + BRA_OTH + BRA_OTH_B_ +POCI+ POCI_B_ +POR_BRA+ POR_BRA_B_),
    Plate = (ACR_PE + ACR_PE_B_+ BRA_TAB_Ac+ BRA_TAB_B_ + TFP_RDG_Al +TFP_RDG_B_ +TFP_RND_Al +TFP_RND_B_),
    Massive = (BRA_DIG_Ac+ BRA_DIG_B_ +FAV_MUS +FAV_MUS_B_ +MASE_OTH +MASEoth_B_ + POR_ENC + POR_ENC_B_ + POR_MASS + POR_MAS_B_),
    Mixed = (ACR_OTH +ACR_OTH_B_+ OTH_HC+ OTH_HC_B_), 
    CT_Oth = (ALC_SF + ALC_SF_B_ + GORG  + GORG_B_ + MINV_COTS + MOB_INV + OTH_SF + OTH_SF_B_ + OTH_SINV + Sand + Other + F_TAPE + Unc + Unk + WATE + ALG_OTH + BMA_sand + CAL_CCA_DC + CAL_CCA_RB + Caul + Chlor + Cya_spe + Dicsp + EAM_DHC + EAM_RB + Lobph + MACR_Cal_H + MAECBS + Pad + Turbin + Seagrass))
    
CCMRtype <-
  CCMRtype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(CCMRtype)
unique(CCMRtype$CT_Tot)

# Group according to Benthic Type
CCMRtype <-
  CCMRtype %>%
  rowwise()%>%
  mutate( 
    HC = (ACR_BRA + ACR_BRA_B_ + ACR_HIP + ACR_HIP_B_ + BRA_OTH + BRA_OTH_B_ +POCI+ POCI_B_ +POR_BRA+ POR_BRA_B_ + ACR_PE + ACR_PE_B_+ BRA_TAB_Ac+ BRA_TAB_B_ + TFP_RDG_Al +TFP_RDG_B_ +TFP_RND_Al +TFP_RND_B_ + BRA_DIG_Ac+ BRA_DIG_B_ +FAV_MUS +FAV_MUS_B_ +MASE_OTH +MASEoth_B_ + POR_ENC + POR_ENC_B_ + POR_MASS + POR_MAS_B_ + ACR_OTH +ACR_OTH_B_+ OTH_HC+ OTH_HC_B_),
    SC = (ALC_SF + ALC_SF_B_ + GORG  + GORG_B_  + OTH_SF + OTH_SF_B_),
    SD = (Sand + BMA_sand),
    RB = (CAL_CCA_RB + EAM_RB),
    RK = (CAL_CCA_DC + EAM_DHC),
    AL = (ALG_OTH + Caul + Chlor + Cya_spe + Dicsp +  Lobph + MACR_Cal_H + MAECBS + Pad + Turbin),
    OT = (MINV_COTS + MOB_INV  + OTH_SINV + Other + F_TAPE + Unc + Unk + WATE),
    SG = (Seagrass))
    
CCMRtype <-
  CCMRtype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(CCMRtype)
unique(CCMRtype$Ben_Tot)

# Select columns

CCMR_type2 <- CCMRtype %>%
  select("Name","Pixel", "ACR_BRA":"Ben_Tot")

# not saved yet
# write file
 CCMR_Mitch <- write.csv(CCMR_Mitch, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/CCMRall_CT_ben.csv")

```

# Add perimeter points

```{r}
# Join dataframes by "Name"

CCMR_type2_Ppt <- inner_join(CCMR_CN, CCMR_Th_FD_P, by = "Name")

colnames(CCMR_type2_Ppt)

```

# Summarise by PeriPoint

```{r Summarise by PeriPt}
# Count number of occurrences of each PeriPt and add that to the table

CCMR_PPt <- CCMR_type2_Ppt %>%
  group_by(PeriPt)%>%
  dplyr::mutate(count = n())

colnames(CCMR_PPt)

#CCMR_PPt <- select(CCMR_PPt, "Name", "PeriPt":"P_Long", "ACR_BRA":"Ben_Tot", "CCMR_uWSL9":"CCMR_Hsmea", "SLOPE", "count")

# Summarise by PeriPt

# Calculate Total coral type points per zone
# when in doubt, add dplyr::

CCMR_TotPts <- CCMR_PPt %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotPts = count*100, TotBrpts = sum(Branching), TotMapts = sum(Massive), TotPpts = sum(Plate),  TotMix = sum(Mixed), TotOthPts = sum(CT_Oth))

colnames(CCMR_TotPts)

# Calculate fractional amount of coral types

CCMR_TotPts <- dplyr::mutate(CCMR_TotPts, BoverTot = (TotBrpts/TotPts), MoverTot = (TotMapts/TotPts), PoverTot = (TotPpts/TotPts), MixoverTot = (TotMix/TotPts))

colnames(CCMR_TotPts)

# Determine Dominant Coral Type per zone

CCMR_DomPerZone <- mutate(CCMR_TotPts, DomZone = ifelse((BoverTot == 0) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "None",
                                                           ifelse(((BoverTot) > (MoverTot)) & ((BoverTot) > (PoverTot)) & ((BoverTot) > (MixoverTot)),  "Branching",                                               
        ifelse(((MoverTot) > (BoverTot)) & ((MoverTot) > (PoverTot)) & ((MoverTot) > (MixoverTot)), "Massive", 
               ifelse(((PoverTot) > (BoverTot)) & ((PoverTot) > (MoverTot)) & ((PoverTot) > (MixoverTot)), "Plate", 
                      "Mixed")))))

unique(CCMR_DomPerZone$DomZone)

head(CCMR_DomPerZone)

colnames(CCMR_DomPerZone)

# check what columns are there
CDom <- CCMR_DomPerZone%>%
  select("Pixel", "PeriPt":"P_Long","count", "Branching":"Ben_Tot", "TotPts": "MixoverTot")

# Summarise Benthic type per Perimeter Point
CCMR_DomPerZone2 <- CCMR_DomPerZone %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotHC = sum(HC), TotSC = sum(SC), TotSD = sum(SD),  TotRB = sum(RB), TotRK = sum(RK), TotAL = sum(AL), TotOT = sum(OT), TotSG = sum(SG))

# select summarised columns
CCMR_DomPerZone2 <- CCMR_DomPerZone2%>%
  select("Pixel", "P_Lat":"P_Long","count","TotHC":"TotSG", "TotPts": "MixoverTot",  "DomZone", "CCMR_uWSL9":"CCMR_Hsmea","SLOPE")

# remove duplicated Ppt rows

CCMR_DomPerZone2 <- CCMR_DomPerZone2 %>% distinct(PeriPt, .keep_all = TRUE)

colnames(CCMR_DomPerZone2)


# Rename columns
CCMRZone <- CCMR_DomPerZone2
names(CCMRZone)[names(CCMRZone) == "CCMR_uWSLm"] <- "uWSLmean"
names(CCMRZone)[names(CCMRZone) == "CCMR_uWSL1"] <- "uWSL100"
#CCMRZone <- rename(CCMRZone, uWSL100=CCMR_uWSL1)
names(CCMRZone)[names(CCMRZone) == "CCMR_uWSL9"] <- "uWSL99"
#CCMRZone <- rename(CCMRZone, uWSL99=CCMR_uWSL9)
names(CCMRZone)[names(CCMRZone) == "CCMR_uWS_1"] <- "uWSL90"
#CCMRZone <- rename(CCMRZone, uWSL90=CCMR_uWS_1)
names(CCMRZone)[names(CCMRZone) == "CCMR_Uonro"] <- "UonrootTmean"
#CCMRZone <- rename(CCMRZone, UonrootTmean=CCMR_Uonro)
names(CCMRZone)[names(CCMRZone) == "CCMR_Uon_1"] <- "UonrootT100"
#CCMRZone <- rename(CCMRZone, UonrootT100=CCMR_Uon_1)
names(CCMRZone)[names(CCMRZone) == "CCMR_Uon_2"] <- "UonrootT99"
#CCMRZone <- rename(CCMRZone, UonrootT99=CCMR_Uon_2)
names(CCMRZone)[names(CCMRZone) == "CCMR_Uon_3"] <- "UonrootT90"
#CCMRZone <- rename(CCMRZone, UonrootT90=CCMR_Uon_3)
names(CCMRZone)[names(CCMRZone) == "CCMR_ubedm"] <- "ubedmean"
#CCMRZone <- rename(CCMRZone,ubedmean=CCMR_ubedm)
names(CCMRZone)[names(CCMRZone) == "CCMR_ubed1"] <- "ubed100"
#CCMRZone <- rename(CCMRZone,ubed100=CCMR_ubed1)
names(CCMRZone)[names(CCMRZone) == "CCMR_ubed9"] <- "ubed99"
#CCMRZone <- rename(CCMRZone,ubed99=CCMR_ubed9)
names(CCMRZone)[names(CCMRZone) == "CCMR_ube_1"] <- "ubed90"
#CCMRZone <- rename(CCMRZone,ubed90=CCMR_ube_1)
names(CCMRZone)[names(CCMRZone) == "CCMR_Tpmea"] <- "Tpmean"
#CCMRZone <- rename(CCMRZone,Tpmean=CCMR_Tpmea)
names(CCMRZone)[names(CCMRZone) == "CCMR_Tp100"] <- "Tp100"
#CCMRZone <- rename(CCMRZone,Tp100=CCMR_Tp100)
names(CCMRZone)[names(CCMRZone) == "CCMR_Tp99_"] <- "Tp99"
#CCMRZone <- rename(CCMRZone,Tp99=CCMR_Tp99_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Tp90_"] <- "Tp90"
#CCMRZone <- rename(CCMRZone,Tp90=CCMR_Tp90_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hsmea"] <- "Hsmean"
#CCMRZone <- rename(CCMRZone,Hsmean=CCMR_Hsmea)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs100"] <- "Hs100"
#CCMRZone <- rename(CCMRZone,Hs100=CCMR_Hs100)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs99_"] <- "Hs99"
#CCMRZone <- rename(CCMRZone,Hs99=CCMR_Hs99_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs98_"] <- "Hs98"
#CCMRZone <- rename(CCMRZone,Hs98=CCMR_Hs98_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs97_"] <- "Hs97"
#CCMRZone <- rename(CCMRZone,Hs97=CCMR_Hs97_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs96_"] <- "Hs96"
#CCMRZone <- rename(CCMRZone,Hs96=CCMR_Hs96_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs95_"] <- "Hs95"
#CCMRZone <- rename(CCMRZone,Hs95=CCMR_Hs95_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs90_"] <- "Hs90"
#CCMRZone <- rename(CCMRZone,Hs90=CCMR_Hs90_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs80_"] <- "Hs80"
#CCMRZone <- rename(CCMRZone,Hs80=CCMR_Hs80_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Hs70_"] <- "Hs70"
#CCMRZone <- rename(CCMRZone,Hs70=CCMR_Hs70_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Efmea"] <- "Efmean"
#CCMRZone <- rename(CCMRZone,Efmean=CCMR_Efmea)
names(CCMRZone)[names(CCMRZone) == "CCMR_Ef100"] <- "Ef100"
#CCMRZone <- rename(CCMRZone,Ef100=CCMR_Ef100)
names(CCMRZone)[names(CCMRZone) == "CCMR_Ef99_"] <- "Ef99"
#CCMRZone <- rename(CCMRZone,Ef99=CCMR_Ef99_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Ef90_"] <- "Ef90"
#CCMRZone <- rename(CCMRZone,Ef90=CCMR_Ef90_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Edmea"] <- "Edmean"
#CCMRZone <- rename(CCMRZone,Edmean=CCMR_Edmea)
names(CCMRZone)[names(CCMRZone) == "CCMR_Ed100"] <- "Ed100"
#CCMRZone <- rename(CCMRZone,Ed100=CCMR_Ed100)
names(CCMRZone)[names(CCMRZone) == "CCMR_Ed99_"] <- "Ed99"
#CCMRZone <- rename(CCMRZone,Ed99=CCMR_Ed99_)
names(CCMRZone)[names(CCMRZone) == "CCMR_Ed90_"] <- "Ed90"
#CCMRZone <- rename(CCMRZone,Ed90=CCMR_Ed90_)

#CCMRZone <- rename(CCMRZone,SLOPE=GBR_Sentin)
colnames(CCMRZone)


# Export CSV
CCMRZone<-write.csv(CCMRZone, file="C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/CCMR_Ppt_waves_summary.csv")
```


# SGBR: ALL including Heron 2018 - CAN'T DO - need to split MKY and TSV

# Heron digit issues

```{r}
names(Heron_Th_FD_int)[names(Heron_Th_FD_int) == "FID_Heron_"] <- "FID_Theiss"

HeronNames <- select(Heron_Th_FD_int, "FID_Theiss", "Name")

colnames(SGBRall)

# remove Heron from MKY

# heron data
Heron_CN <- semi_join(SGBRall, HeronNames, by = "Name")
colnames(Heron_CN)

# MKY data
MKY_CN <- anti_join(SGBRall, HeronNames,  by = "Name")
colnames(MKY_CN)

# Perimeter Points for Heron

Heron_FD <- inner_join(Heron_peri_points, HeronNames, by = "FID_Theiss")

```


```{r Southern GBR ALL}
# Southern GBR ALL
# Read in data and make a copy

SGBR <- bind_rows(MKY_CN, Heron_CN)

# Group data according to spreadsheet - Coral Type
SGBRtype <-
  SGBR %>%
  rowwise()%>%
  mutate( 
    Branching = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B`),
    Plate = (`ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B`),
    Massive = (`BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B`),
    Mixed = (`ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    CT_Oth = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `MINV_COTS` + `MOB-INV` + `OTH-SF` + `OTH-SF-B` + `OTH-SINV` + `Sand` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE` + `ALG_OTH` + `BMA_sand` + `CAL_CCA_DC` + `CAL_CCA_RB` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` + `EAM_DHC` + `EAM_RB` + `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin` + `Seagrass`))
    
SGBRtype <-
  SGBRtype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(SGBRtype)
unique(SGBRtype$CT_Tot)

# Group according to Benthic Type
SGBRtype <-
  SGBRtype %>%
  rowwise()%>%
  mutate( 
    HC = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B` + `ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B` + `BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B` + `ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    SC = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `OTH-SF` + `OTH-SF-B`),
    SD = (`Sand` + `BMA_sand`),
    RB = (`CAL_CCA_RB` + `EAM_RB`),
    RK = (`CAL_CCA_DC` + `EAM_DHC`),
    AL = (`ALG_OTH` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` +  `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin`),
    OT = (`MINV_COTS` + `MOB-INV`  + `OTH-SINV` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE`),
    SG = (`Seagrass`))
    
SGBRtype <-
  SGBRtype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(SGBRtype)
unique(SGBRtype$Ben_Tot)

# CLip the columns


# Select columns

SGBRtype <- SGBRtype %>%
  select("Name", "Branching":"Ben_Tot")


```

# Add perimeter points
# First join TSV and MKY/HR files - no - have to do them separately

```{r}
# Join TSV names to Peri points
# read in files

TSVwaves <- TSV_Peri_Th_int2

TSVnames <- TSV_Th_FD_P

TSVps <- inner_join(TSVnames, TSVwaves, by = "FID_TSV_th")


# Rename columns
colnames(TSVps)
names(TSVps)[names(TSVps) == "TSV_uWSLme"] <- "uWSLmean"
names(TSVps)[names(TSVps) == "TSV_uWSL10"] <- "uWSL100"
#TSVps <- rename(TSVps, uWSL100=TSV_uWSL1)
names(TSVps)[names(TSVps) == "TSV_uWSL99"] <- "uWSL99"
#TSVps <- rename(TSVps, uWSL99=TSV_uWSL9)
names(TSVps)[names(TSVps) == "TSV_uWSL90"] <- "uWSL90"
#TSVps <- rename(TSVps, uWSL90=TSV_uWS_1)
names(TSVps)[names(TSVps) == "TSV_Uonroo"] <- "UonrootTmean"
#TSVps <- rename(TSVps, UonrootTmean=TSV_Uonro)
names(TSVps)[names(TSVps) == "TSV_Uonr_1"] <- "UonrootT100"
#TSVps <- rename(TSVps, UonrootT100=TSV_Uon_1)
names(TSVps)[names(TSVps) == "TSV_Uonr_2"] <- "UonrootT99"
#TSVps <- rename(TSVps, UonrootT99=TSV_Uon_2)
names(TSVps)[names(TSVps) == "TSV_Uonr_3"] <- "UonrootT90"
#TSVps <- rename(TSVps, UonrootT90=TSV_Uon_3)
names(TSVps)[names(TSVps) == "TSV_ubedme"] <- "ubedmean"
#TSVps <- rename(TSVps,ubedmean=TSV_ubedm)
names(TSVps)[names(TSVps) == "TSV_ubed10"] <- "ubed100"
#TSVps <- rename(TSVps,ubed100=TSV_ubed1)
names(TSVps)[names(TSVps) == "TSV_ubed99"] <- "ubed99"
#TSVps <- rename(TSVps,ubed99=TSV_ubed9)
names(TSVps)[names(TSVps) == "TSV_ubed90"] <- "ubed90"
#TSVps <- rename(TSVps,ubed90=TSV_ube_1)
names(TSVps)[names(TSVps) == "TSV_Tpmean"] <- "Tpmean"
#TSVps <- rename(TSVps,Tpmean=TSV_Tpmea)
names(TSVps)[names(TSVps) == "TSV_Tp100_"] <- "Tp100"
#TSVps <- rename(TSVps,Tp100=TSV_Tp100)
names(TSVps)[names(TSVps) == "TSV_Tp99_R"] <- "Tp99"
#TSVps <- rename(TSVps,Tp99=TSV_Tp99_)
names(TSVps)[names(TSVps) == "TSV_Tp90_R"] <- "Tp90"
#TSVps <- rename(TSVps,Tp90=TSV_Tp90_)
names(TSVps)[names(TSVps) == "TSV_Hsmean"] <- "Hsmean"
#TSVps <- rename(TSVps,Hsmean=TSV_Hsmea)
names(TSVps)[names(TSVps) == "TSV_Hs100_"] <- "Hs100"
#TSVps <- rename(TSVps,Hs100=TSV_Hs100)
names(TSVps)[names(TSVps) == "TSV_Hs99_R"] <- "Hs99"
#TSVps <- rename(TSVps,Hs99=TSV_Hs99_)
names(TSVps)[names(TSVps) == "TSV_Hs98_R"] <- "Hs98"
#TSVps <- rename(TSVps,Hs98=TSV_Hs98_)
names(TSVps)[names(TSVps) == "TSV_Hs97_R"] <- "Hs97"
#TSVps <- rename(TSVps,Hs97=TSV_Hs97_)
names(TSVps)[names(TSVps) == "TSV_Hs96_R"] <- "Hs96"
#TSVps <- rename(TSVps,Hs96=TSV_Hs96_)
names(TSVps)[names(TSVps) == "TSV_Hs95_R"] <- "Hs95"
#TSVps <- rename(TSVps,Hs95=TSV_Hs95_)
names(TSVps)[names(TSVps) == "TSV_Hs90_R"] <- "Hs90"
#TSVps <- rename(TSVps,Hs90=TSV_Hs90_)
names(TSVps)[names(TSVps) == "TSV_Hs80_R"] <- "Hs80"
#TSVps <- rename(TSVps,Hs80=TSV_Hs80_)
names(TSVps)[names(TSVps) == "TSV_Hs70_R"] <- "Hs70"
#TSVps <- rename(TSVps,Hs70=TSV_Hs70_)
names(TSVps)[names(TSVps) == "TSV_Efmean"] <- "Efmean"
#TSVps <- rename(TSVps,Efmean=TSV_Efmea)
names(TSVps)[names(TSVps) == "TSV_Ef100_"] <- "Ef100"
#TSVps <- rename(TSVps,Ef100=TSV_Ef100)
names(TSVps)[names(TSVps) == "TSV_Ef99_R"] <- "Ef99"
#TSVps <- rename(TSVps,Ef99=TSV_Ef99_)
names(TSVps)[names(TSVps) == "TSV_Ef90_R"] <- "Ef90"
#TSVps <- rename(TSVps,Ef90=TSV_Ef90_)
names(TSVps)[names(TSVps) == "TSV_Edmean"] <- "Edmean"
#TSVps <- rename(TSVps,Edmean=TSV_Edmea)
names(TSVps)[names(TSVps) == "TSV_Ed100_"] <- "Ed100"
#TSVps <- rename(TSVps,Ed100=TSV_Ed100)
names(TSVps)[names(TSVps) == "TSV_Ed99_R"] <- "Ed99"
#TSVps <- rename(TSVps,Ed99=TSV_Ed99_)
names(TSVps)[names(TSVps) == "TSV_Ed90_R"] <- "Ed90"
#TSVps <- rename(TSVps,Ed90=TSV_Ed90_)
names(TSVps)[names(TSVps) == "TSV_slope"] <- "SLOPE"
#TSVps <- rename(TSVps,SLOPE=GBR_Sentin)
names(TSVps)[names(TSVps) == "image_name"] <- "Name"
names(TSVps)[names(TSVps) == "PeriPt.x"] <- "PeriPt"
names(TSVps)[names(TSVps) == "P_Lat.x"] <- "P_Lat"
names(TSVps)[names(TSVps) == "P_Long.x"] <- "P_Long"
colnames(TSVps)
TSVps <- select(TSVps, "Name":"SLOPE")

# MKY/HR
names(MKY_HR_Th_FD_P_W_S_20200526)[names(MKY_HR_Th_FD_P_W_S_20200526) == "image_name"] <- "Name"
names(MKY_HR_Th_FD_P_W_S_20200526)[names(MKY_HR_Th_FD_P_W_S_20200526) == "uonrootTmean"] <- "UonrootTmean"
names(MKY_HR_Th_FD_P_W_S_20200526)[names(MKY_HR_Th_FD_P_W_S_20200526) == "uonrootT99"] <- "UonrootT99"
names(MKY_HR_Th_FD_P_W_S_20200526)[names(MKY_HR_Th_FD_P_W_S_20200526) == "uonrootT100"] <- "UonrootT100"
names(MKY_HR_Th_FD_P_W_S_20200526)[names(MKY_HR_Th_FD_P_W_S_20200526) == "uonrootT90"] <- "UonrootT90"

colnames((MKY_HR_Th_FD_P_W_S_20200526))

MKY_HR_Th_FD_P_W_S_20200526 <- select(MKY_HR_Th_FD_P_W_S_20200526, "Name":"Edmean")

# Remove Heron
MKY_points <- anti_join(MKY_HR_Th_FD_P_W_S_20200526, HeronNames,  by = "Name")

colnames(Heron_points)
colnames(MKY_points)

# Rename Heron wave parameters

names(Heron_points)[names(Heron_points) == "uWSLmean_R"] <- "uWSLmean"
names(Heron_points)[names(Heron_points) == "uWSL100_Ra"] <- "uWSL100"
#TSVps <- rename(TSVps, uWSL100=TSV_uWSL1)
names(Heron_points)[names(Heron_points) == "uWSL99_Ras"] <- "uWSL99"
#Heron_points <- rename(Heron_points, uWSL99=TSV_uWSL9)
names(Heron_points)[names(Heron_points) == "uWSL90_Ras"] <- "uWSL90"
#Heron_points <- rename(Heron_points, uWSL90=TSV_uWS_1)
names(Heron_points)[names(Heron_points) == "uonrootTme"] <- "UonrootTmean"
#Heron_points <- rename(Heron_points, UonrootTmean=TSV_Uonro)
names(Heron_points)[names(Heron_points) == "uonrootT10"] <- "UonrootT100"
#Heron_points <- rename(Heron_points, UonrootT100=TSV_Uon_1)
names(Heron_points)[names(Heron_points) == "uonrootT99"] <- "UonrootT99"
#Heron_points <- rename(Heron_points, UonrootT99=TSV_Uon_2)
names(Heron_points)[names(Heron_points) == "uonrootT90"] <- "UonrootT90"
#Heron_points <- rename(Heron_points, UonrootT90=TSV_Uon_3)
names(Heron_points)[names(Heron_points) == "ubedmean_R"] <- "ubedmean"
#Heron_points <- rename(Heron_points,ubedmean=TSV_ubedm)
names(Heron_points)[names(Heron_points) == "ubed100_Ra"] <- "ubed100"
#Heron_points <- rename(Heron_points,ubed100=TSV_ubed1)
names(Heron_points)[names(Heron_points) == "ubed99_Ras"] <- "ubed99"
#Heron_points <- rename(Heron_points,ubed99=TSV_ubed9)
names(Heron_points)[names(Heron_points) == "ubed90_Ras"] <- "ubed90"
#Heron_points <- rename(Heron_points,ubed90=TSV_ube_1)
names(Heron_points)[names(Heron_points) == "Tpmean_Ras"] <- "Tpmean"
#Heron_points <- rename(Heron_points,Tpmean=TSV_Tpmea)
names(Heron_points)[names(Heron_points) == "Tp100_Rast"] <- "Tp100"
#Heron_points <- rename(Heron_points,Tp100=TSV_Tp100)
names(Heron_points)[names(Heron_points) == "Tp99_Raste"] <- "Tp99"
#Heron_points <- rename(Heron_points,Tp99=TSV_Tp99_)
names(Heron_points)[names(Heron_points) == "Tp90_Raste"] <- "Tp90"
#Heron_points <- rename(Heron_points,Tp90=TSV_Tp90_)
names(Heron_points)[names(Heron_points) == "Hsmean_Ras"] <- "Hsmean"
#Heron_points <- rename(Heron_points,Hsmean=TSV_Hsmea)
names(Heron_points)[names(Heron_points) == "Hs100_Rast"] <- "Hs100"
#Heron_points <- rename(Heron_points,Hs100=TSV_Hs100)
names(Heron_points)[names(Heron_points) == "Hs99_Raste"] <- "Hs99"
#Heron_points <- rename(Heron_points,Hs99=TSV_Hs99_)
names(Heron_points)[names(Heron_points) == "Hs98_Raste"] <- "Hs98"
#Heron_points <- rename(Heron_points,Hs98=TSV_Hs98_)
names(Heron_points)[names(Heron_points) == "Hs97_Raste"] <- "Hs97"
#Heron_points <- rename(Heron_points,Hs97=TSV_Hs97_)
names(Heron_points)[names(Heron_points) == "Hs96_Raste"] <- "Hs96"
#Heron_points <- rename(Heron_points,Hs96=TSV_Hs96_)
names(Heron_points)[names(Heron_points) == "Mackay_Hs9"] <- "Hs95"
#Heron_points <- rename(Heron_points,Hs95=TSV_Hs95_)
names(Heron_points)[names(Heron_points) == "Hs90_Raste"] <- "Hs90"
#Heron_points <- rename(Heron_points,Hs90=TSV_Hs90_)
names(Heron_points)[names(Heron_points) == "Hs80_Raste"] <- "Hs80"
#Heron_points <- rename(Heron_points,Hs80=TSV_Hs80_)
names(Heron_points)[names(Heron_points) == "Hs70_Raste"] <- "Hs70"
#Heron_points <- rename(Heron_points,Hs70=TSV_Hs70_)
names(Heron_points)[names(Heron_points) == "Efmean_Ras"] <- "Efmean"
#Heron_points <- rename(Heron_points,Efmean=TSV_Efmea)
names(Heron_points)[names(Heron_points) == "Ef100_Rast"] <- "Ef100"
#Heron_points <- rename(Heron_points,Ef100=TSV_Ef100)
names(Heron_points)[names(Heron_points) == "Ef99_Raste"] <- "Ef99"
#Heron_points <- rename(Heron_points,Ef99=TSV_Ef99_)
names(Heron_points)[names(Heron_points) == "Ef90_Raste"] <- "Ef90"
#Heron_points <- rename(Heron_points,Ef90=TSV_Ef90_)
names(Heron_points)[names(Heron_points) == "Edmean_Ras"] <- "Edmean"
#Heron_points <- rename(Heron_points,Edmean=TSV_Edmea)
names(Heron_points)[names(Heron_points) == "Ed100_Rast"] <- "Ed100"
#Heron_points <- rename(Heron_points,Ed100=TSV_Ed100)
names(Heron_points)[names(Heron_points) == "Ed99_Raste"] <- "Ed99"
#Heron_points <- rename(Heron_points,Ed99=TSV_Ed99_)
names(Heron_points)[names(Heron_points) == "Ed90_Raste"] <- "Ed90"
#Heron_points <- rename(Heron_points,Ed90=TSV_Ed90_)
names(Heron_points)[names(Heron_points) == "Heron_SLOP"] <- "SLOPE"

colnames(Heron_points)
Heron_points <- Heron_points%>%
  select("SLOPE":"P_Long", "PeriPt":"Name")
colnames(Heron_points)
colnames(MKY_HR_Th_FD_P_W_S_20200526)

# Combine Heron and MKY
MKYHRpts <- bind_rows(MKY_points, Heron_points)

# write to CSV
MKYHRpts <- write.csv(MKYHRpts, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/PeripointArcData/MKYHRpts.csv")

colnames(SGBRtype)

# Make unique names for TSV and MKY/HR
# Make ID specific
TSVps <- TSVps %>% dplyr::mutate(Region = as.character("TSV_"))

TSVps <- TSVps %>% dplyr::mutate(id = row_number())

TSVps <- TSVps %>% unite("Pixel", Region:id, remove = FALSE)
colnames(TSVps)
TSVps2 <- TSVps%>%
  select("Name":"P_Long", "Ed90":"SLOPE","Pixel" )

MKYHRpts <- MKYHRpts %>% dplyr::mutate(Region = as.character("MKY_"))

MKYHRpts <- MKYHRpts %>% dplyr::mutate(id = row_number())

MKYHRpts <- MKYHRpts %>% unite("Pixel", Region:id, remove = FALSE)
colnames(MKYHRpts)
unique(MKYHRpts$Pixel)

MKYps2 <- MKYHRpts%>%
  select("Name", "SLOPE":"Pixel" )

MKYcor <- inner_join(MKYps2, MKY_probs, by = "Name")
colnames(MKYcor)

# Bind Rows - no - need to do separately
#SGBR_CT <- bind_rows(MKYps2, TSVps)

# write to file

TSVps2 <- write.csv(TSVps2, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/PeripointArcData/TSVwavesPpts.csv") 
colnames(TSVeverythingCT)

MKYcor <- write.csv(MKYcor, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/PeripointArcData/MKYwavesPpts.csv") 

colnames(MKYwavesPpts)
```

# try Heron by itself

```{r}
Heron <- percent_covers_Heron2018

# Make ID Heron specific 
Heron <- Heron %>% 
  #rowwise()%>%
  dplyr::mutate(id = row_number())

unique(Heron$id)

Heron <- Heron %>% dplyr::mutate(Region = as.character("Heron_"))

colnames(Heron)
Heron <- Heron %>% unite("Pixel", Region:id, remove = FALSE)

# Group data according to spreadsheet - Coral Type
Herontype <-
  Heron %>%
  rowwise()%>%
  mutate( 
    Branching = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B`),
    Plate = (`ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B`),
    Massive = (`BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B`),
    Mixed = (`ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    CT_Oth = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `MINV_COTS` + `MOB-INV` + `OTH-SF` + `OTH-SF-B` + `OTH-SINV` + `Sand` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE` + `ALG_OTH` + `BMA_sand` + `CAL_CCA_DC` + `CAL_CCA_RB` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` + `EAM_DHC` + `EAM_RB` + `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin` + `Seagrass`))
    
Herontype <-
  Herontype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(Herontype)
unique(Herontype$CT_Tot)

# Group according to Benthic Type
Herontype <-
  Herontype %>%
  rowwise()%>%
  mutate( 
    HC = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B` + `ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B` + `BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B` + `ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    SC = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `OTH-SF` + `OTH-SF-B`),
    SD = (`Sand` + `BMA_sand`),
    RB = (`CAL_CCA_RB` + `EAM_RB`),
    RK = (`CAL_CCA_DC` + `EAM_DHC`),
    AL = (`ALG_OTH` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` +  `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin`),
    OT = (`MINV_COTS` + `MOB-INV`  + `OTH-SINV` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE`),
    SG = (`Seagrass`))
    
Herontype <-
  Herontype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(Herontype)
unique(Herontype$Ben_Tot)

# select columns

Herontype <- Herontype %>%
  select("Name", "Pixel", "Branching":"Ben_Tot")

# Perimeter points
names(Heron_Th_FD_int)[names(Heron_Th_FD_int) == "FID_Heron_"] <- "FID_Theiss"

HeronNames <- select(Heron_Th_FD_int, "FID_Theiss", "Name")

# Perimeter Points for Heron

Heron_points <- inner_join(Heron_peri_points, HeronNames, by = "FID_Theiss")


# Join FD to Perimeter points
Heron_FD <- inner_join(Herontype, Heron_points, by = "Name")

# Rename Heron wave parameters

names(Heron_FD)[names(Heron_FD) == "uWSLmean_R"] <- "uWSLmean"
names(Heron_FD)[names(Heron_FD) == "uWSL100_Ra"] <- "uWSL100"
#TSVps <- rename(TSVps, uWSL100=TSV_uWSL1)
names(Heron_FD)[names(Heron_FD) == "uWSL99_Ras"] <- "uWSL99"
#Heron_FD <- rename(Heron_FD, uWSL99=TSV_uWSL9)
names(Heron_FD)[names(Heron_FD) == "uWSL90_Ras"] <- "uWSL90"
#Heron_FD <- rename(Heron_FD, uWSL90=TSV_uWS_1)
names(Heron_FD)[names(Heron_FD) == "uonrootTme"] <- "UonrootTmean"
#Heron_FD <- rename(Heron_FD, UonrootTmean=TSV_Uonro)
names(Heron_FD)[names(Heron_FD) == "uonrootT10"] <- "UonrootT100"
#Heron_FD <- rename(Heron_FD, UonrootT100=TSV_Uon_1)
names(Heron_FD)[names(Heron_FD) == "uonrootT99"] <- "UonrootT99"
#Heron_FD <- rename(Heron_FD, UonrootT99=TSV_Uon_2)
names(Heron_FD)[names(Heron_FD) == "uonrootT90"] <- "UonrootT90"
#Heron_FD <- rename(Heron_FD, UonrootT90=TSV_Uon_3)
names(Heron_FD)[names(Heron_FD) == "ubedmean_R"] <- "ubedmean"
#Heron_FD <- rename(Heron_FD,ubedmean=TSV_ubedm)
names(Heron_FD)[names(Heron_FD) == "ubed100_Ra"] <- "ubed100"
#Heron_FD <- rename(Heron_FD,ubed100=TSV_ubed1)
names(Heron_FD)[names(Heron_FD) == "ubed99_Ras"] <- "ubed99"
#Heron_FD <- rename(Heron_FD,ubed99=TSV_ubed9)
names(Heron_FD)[names(Heron_FD) == "ubed90_Ras"] <- "ubed90"
#Heron_FD <- rename(Heron_FD,ubed90=TSV_ube_1)
names(Heron_FD)[names(Heron_FD) == "Tpmean_Ras"] <- "Tpmean"
#Heron_FD <- rename(Heron_FD,Tpmean=TSV_Tpmea)
names(Heron_FD)[names(Heron_FD) == "Tp100_Rast"] <- "Tp100"
#Heron_FD <- rename(Heron_FD,Tp100=TSV_Tp100)
names(Heron_FD)[names(Heron_FD) == "Tp99_Raste"] <- "Tp99"
#Heron_FD <- rename(Heron_FD,Tp99=TSV_Tp99_)
names(Heron_FD)[names(Heron_FD) == "Tp90_Raste"] <- "Tp90"
#Heron_FD <- rename(Heron_FD,Tp90=TSV_Tp90_)
names(Heron_FD)[names(Heron_FD) == "Hsmean_Ras"] <- "Hsmean"
#Heron_FD <- rename(Heron_FD,Hsmean=TSV_Hsmea)
names(Heron_FD)[names(Heron_FD) == "Hs100_Rast"] <- "Hs100"
#Heron_FD <- rename(Heron_FD,Hs100=TSV_Hs100)
names(Heron_FD)[names(Heron_FD) == "Hs99_Raste"] <- "Hs99"
#Heron_FD <- rename(Heron_FD,Hs99=TSV_Hs99_)
names(Heron_FD)[names(Heron_FD) == "Hs98_Raste"] <- "Hs98"
#Heron_FD <- rename(Heron_FD,Hs98=TSV_Hs98_)
names(Heron_FD)[names(Heron_FD) == "Hs97_Raste"] <- "Hs97"
#Heron_FD <- rename(Heron_FD,Hs97=TSV_Hs97_)
names(Heron_FD)[names(Heron_FD) == "Hs96_Raste"] <- "Hs96"
#Heron_FD <- rename(Heron_FD,Hs96=TSV_Hs96_)
names(Heron_FD)[names(Heron_FD) == "Mackay_Hs9"] <- "Hs95"
#Heron_FD <- rename(Heron_FD,Hs95=TSV_Hs95_)
names(Heron_FD)[names(Heron_FD) == "Hs90_Raste"] <- "Hs90"
#Heron_FD <- rename(Heron_FD,Hs90=TSV_Hs90_)
names(Heron_FD)[names(Heron_FD) == "Hs80_Raste"] <- "Hs80"
#Heron_FD <- rename(Heron_FD,Hs80=TSV_Hs80_)
names(Heron_FD)[names(Heron_FD) == "Hs70_Raste"] <- "Hs70"
#Heron_FD <- rename(Heron_FD,Hs70=TSV_Hs70_)
names(Heron_FD)[names(Heron_FD) == "Efmean_Ras"] <- "Efmean"
#Heron_FD <- rename(Heron_FD,Efmean=TSV_Efmea)
names(Heron_FD)[names(Heron_FD) == "Ef100_Rast"] <- "Ef100"
#Heron_FD <- rename(Heron_FD,Ef100=TSV_Ef100)
names(Heron_FD)[names(Heron_FD) == "Ef99_Raste"] <- "Ef99"
#Heron_FD <- rename(Heron_FD,Ef99=TSV_Ef99_)
names(Heron_FD)[names(Heron_FD) == "Ef90_Raste"] <- "Ef90"
#Heron_FD <- rename(Heron_FD,Ef90=TSV_Ef90_)
names(Heron_FD)[names(Heron_FD) == "Edmean_Ras"] <- "Edmean"
#Heron_FD <- rename(Heron_FD,Edmean=TSV_Edmea)
names(Heron_FD)[names(Heron_FD) == "Ed100_Rast"] <- "Ed100"
#Heron_FD <- rename(Heron_FD,Ed100=TSV_Ed100)
names(Heron_FD)[names(Heron_FD) == "Ed99_Raste"] <- "Ed99"
#Heron_FD <- rename(Heron_FD,Ed99=TSV_Ed99_)
names(Heron_FD)[names(Heron_FD) == "Ed90_Raste"] <- "Ed90"
#Heron_FD <- rename(Heron_FD,Ed90=TSV_Ed90_)
names(Heron_FD)[names(Heron_FD) == "Heron_SLOP"] <- "SLOPE"

colnames(Heron_FD)

# write to file

Heron_FD <- write.csv(Heron_FD, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/PeripointArcData/HeroneverythingCT.csv") 

# Read in Data

HeronCT <- HeroneverythingCT
colnames(HeronCT)

# Count number of occurrences of each PeriPt and add that to the table

HeronCT <- HeronCT %>%
  group_by(PeriPt)%>%
  dplyr::mutate(count = n())

colnames(HeronCT)

# Summarise by PeriPt

# Calculate Total coral type points per zone
# when in doubt, add dplyr::

HR_TotPts <- HeronCT %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotPts = count*100, TotBrpts = sum(Branching), TotMapts = sum(Massive), TotPpts = sum(Plate),  TotMix = sum(Mixed), TotOthPts = sum(CT_Oth))

colnames(HR_TotPts)


# Calculate fractional amount of coral types

HR_TotPts <- HR_TotPts%>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(BoverTot = (TotBrpts/TotPts), MoverTot = (TotMapts/TotPts), PoverTot = (TotPpts/TotPts), MixoverTot = (TotMix/TotPts))

colnames(HR_TotPts)


# Determine Dominant Coral Type per zone

HR_DomPerZone <- mutate(HR_TotPts, DomZone = ifelse((BoverTot == 0) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "None",
                                                           ifelse(((BoverTot) > (MoverTot)) & ((BoverTot) > (PoverTot)) & ((BoverTot) > (MixoverTot)),  "Branching",                                               
        ifelse(((MoverTot) > (BoverTot)) & ((MoverTot) > (PoverTot)) & ((MoverTot) > (MixoverTot)), "Massive", 
               ifelse(((PoverTot) > (BoverTot)) & ((PoverTot) > (MoverTot)) & ((PoverTot) > (MixoverTot)), "Plate", 
                      "Mixed")))))

unique(HR_DomPerZone$DomZone)

colnames(HR_DomPerZone)

# check what columns are there
#HRDom <- HR_DomPerZone%>%
#  select("Pixel", "PeriPt", "P_Lat":"P_Long","count", "Branching":"Ben_Tot", "TotPts": "MixoverTot")

# Summarise Benthic type per Perimeter Point
HR_DomPerZone2 <- HR_DomPerZone %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotHC = sum(HC), TotSC = sum(SC), TotSD = sum(SD),  TotRB = sum(RB), TotRK = sum(RK), TotAL = sum(AL), TotOT = sum(OT), TotSG = sum(SG))

colnames((HR_DomPerZone2))

# select summarised columns
HR_DomPerZone2 <- HR_DomPerZone2%>%
  select("Pixel", "P_Lat":"P_Long","count","TotHC":"TotSG", "TotPts": "DomZone", "SLOPE":"Edmean")

# remove duplicated Ppt rows

HRZone <- HR_DomPerZone2 %>% distinct(PeriPt, .keep_all = TRUE)

colnames(HRZone)


options(digits = 10)
#  Save
HRZone <- write.csv(HRZone, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/HR_Ppt_waves_summary.csv")

# Join to the remainder of the GBR

HR_Ppt_waves_summary <- HR_Ppt_waves_summary%>%
  select("Pixel":"Edmean")
GBR <- bind_rows(WholeGBR_Ppt_waves_summary_out, HR_Ppt_waves_summary)

# write to file

GBR <- write.csv(GBR, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/PerRegion2021/WGBR_Heron_out.csv") 

```


# Already done....
# Join Perimeter points to field data by image names

```{r}
TSV_FD <- inner_join(SGBRtype, TSVwavesPpts, by = "Name")
MKYps2 <- MKYwavesPpts
colnames(MKYps2)
unique(MKYps2$P_Long)
MKY_FD <- inner_join(SGBRtype, MKYps2, by = "Name")

colnames(MKY_FD)
unique(MKY_FD$P_Long)

# write to file

TSV_FD <- write.csv(TSV_FD, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/PeripointArcData/TSVeverythingCT.csv") 

MKY_FD <- write.csv(MKY_FD, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/PeripointArcData/MKYeverythingCT.csv") 

colnames(MKYeverythingCT)
unique(MKYeverythingCT$P_Long)

```

# Summarise by PeriPoint

```{r Summarise by PeriPt}
# Read in data and select columns


# Count number of occurrences of each PeriPt and add that to the table

TSV <- TSVeverythingCT %>%
  group_by(PeriPt)%>%
  dplyr::mutate(count = n())

colnames(TSV)

MKY <- MKYeverythingCT %>%
  group_by(PeriPt)%>%
  dplyr::mutate(count = n())

colnames(MKY)
unique(MKY$P_Long)

# Summarise by PeriPt

# Calculate Total coral type points per zone
# when in doubt, add dplyr::

TSV_TotPts <- TSV %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotPts = count*100, TotBrpts = sum(Branching), TotMapts = sum(Massive), TotPpts = sum(Plate),  TotMix = sum(Mixed), TotOthPts = sum(CT_Oth))

colnames(TSV_TotPts)

MKY_TotPts <- MKY %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotPts = count*100, TotBrpts = sum(Branching), TotMapts = sum(Massive), TotPpts = sum(Plate),  TotMix = sum(Mixed), TotOthPts = sum(CT_Oth))

colnames(MKY_TotPts)

# Calculate fractional amount of coral types

TSV_TotPts <- TSV_TotPts%>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(BoverTot = (TotBrpts/TotPts), MoverTot = (TotMapts/TotPts), PoverTot = (TotPpts/TotPts), MixoverTot = (TotMix/TotPts))

colnames(TSV_TotPts)

MKY_TotPts <- MKY_TotPts%>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(BoverTot = (TotBrpts/TotPts), MoverTot = (TotMapts/TotPts), PoverTot = (TotPpts/TotPts), MixoverTot = (TotMix/TotPts))

colnames(MKY_TotPts)

# Determine Dominant Coral Type per zone

TSV_DomPerZone <- mutate(TSV_TotPts, DomZone = ifelse((BoverTot == 0) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "None",
                                                           ifelse(((BoverTot) > (MoverTot)) & ((BoverTot) > (PoverTot)) & ((BoverTot) > (MixoverTot)),  "Branching",                                               
        ifelse(((MoverTot) > (BoverTot)) & ((MoverTot) > (PoverTot)) & ((MoverTot) > (MixoverTot)), "Massive", 
               ifelse(((PoverTot) > (BoverTot)) & ((PoverTot) > (MoverTot)) & ((PoverTot) > (MixoverTot)), "Plate", 
                      "Mixed")))))

unique(TSV_DomPerZone$DomZone)

colnames(TSV_DomPerZone)

MKY_DomPerZone <- mutate(MKY_TotPts, DomZone = ifelse((BoverTot == 0) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "None",
                                                           ifelse(((BoverTot) > (MoverTot)) & ((BoverTot) > (PoverTot)) & ((BoverTot) > (MixoverTot)),  "Branching",                                               
        ifelse(((MoverTot) > (BoverTot)) & ((MoverTot) > (PoverTot)) & ((MoverTot) > (MixoverTot)), "Massive", 
               ifelse(((PoverTot) > (BoverTot)) & ((PoverTot) > (MoverTot)) & ((PoverTot) > (MixoverTot)), "Plate", 
                      "Mixed")))))

unique(MKY_DomPerZone$DomZone)

colnames(MKY_DomPerZone)

# check what columns are there
TDom <- TSV_DomPerZone%>%
  select("Pixel", "PeriPt":"P_Long","count", "Branching":"Ben_Tot", "TotPts": "MixoverTot")

# Summarise Benthic type per Perimeter Point
TSV_DomPerZone2 <- TSV_DomPerZone %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotHC = sum(HC), TotSC = sum(SC), TotSD = sum(SD),  TotRB = sum(RB), TotRK = sum(RK), TotAL = sum(AL), TotOT = sum(OT), TotSG = sum(SG))

MKY_DomPerZone2 <- MKY_DomPerZone %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotHC = sum(HC), TotSC = sum(SC), TotSD = sum(SD),  TotRB = sum(RB), TotRK = sum(RK), TotAL = sum(AL), TotOT = sum(OT), TotSG = sum(SG))

colnames(MKY_DomPerZone2)

# select summarised columns
TSV_DomPerZone2 <- TSV_DomPerZone2%>%
  select("Pixel", "P_Lat":"P_Long","count","TotHC":"TotSG", "TotPts": "MixoverTot", "DomZone", "Ed90":"SLOPE")

MKY_DomPerZone2 <- MKY_DomPerZone2%>%
  select("Pixel", "P_Lat":"P_Long","count","TotHC":"TotSG", "TotPts": "MixoverTot", "DomZone", "uWSLmean":"Edmean","SLOPE")

unique(MKY_DomPerZone2$P_Long)

# remove duplicated Ppt rows

TSVZone <- TSV_DomPerZone2 %>% distinct(PeriPt, .keep_all = TRUE)

colnames(TSVZone)

MKYZone <- MKY_DomPerZone2 %>% distinct(PeriPt, .keep_all = TRUE)

colnames(MKYZone)
unique(MKYZone$P_Long)

options(digits = 10)
#  Save
TSVZone <- write.csv(TSVZone, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/TSV_Ppt_waves_summary.csv")

MKYZone <- write.csv(MKYZone,  file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/PerRegion2021/MKY_Ppt_waves_summary.csv")

```

# FNGBR plus Legacy

```{r}
# Read in data

FNGBR_CN <- FNGBR
colnames(FNGBR_CN)
colnames(Legacy_CN)


# write to file
legacy_CN <- write.csv(legacy_CN, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralNet/Legacy_CN.csv")

# Legacy is processed for Mitch
# Process FNGBR_CN to Ben_Tot

# Group data according to spreadsheet - Coral Type
FNGBRtype <-
  FNGBR_CN %>%
  rowwise()%>%
  mutate( 
    Branching = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B`),
    Plate = (`ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B`),
    Massive = (`BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B`),
    Mixed = (`ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    CT_Oth = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `MINV_COTS` + `MOB-INV` + `OTH-SF` + `OTH-SF-B` + `OTH-SINV` + `Sand` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE` + `ALG_OTH` + `BMA_sand` + `CAL_CCA_DC` + `CAL_CCA_RB` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` + `EAM_DHC` + `EAM_RB` + `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin` + `Seagrass`))
    
FNGBRtype <-
  FNGBRtype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(FNGBRtype)
unique(FNGBRtype$CT_Tot)

# Group according to Benthic Type
FNGBRtype <-
  FNGBRtype %>%
  rowwise()%>%
  mutate( 
    HC = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B` + `ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B` + `BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B` + `ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    SC = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `OTH-SF` + `OTH-SF-B`),
    SD = (`Sand` + `BMA_sand`),
    RB = (`CAL_CCA_RB` + `EAM_RB`),
    RK = (`CAL_CCA_DC` + `EAM_DHC`),
    AL = (`ALG_OTH` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` +  `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin`),
    OT = (`MINV_COTS` + `MOB-INV`  + `OTH-SINV` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE`),
    SG = (`Seagrass`))
    
FNGBRtype <-
  FNGBRtype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(FNGBRtype)
unique(FNGBRtype$Ben_Tot)

# Join Legacy and FNGBR
FNGBRtype <- FNGBRtype%>%
  select("Name", "Branching":"Ben_Tot")

colnames(Legacy_CN)
Leg_type <- Legacy_CN%>%
  select("Name", "Branching":"Ben_Tot")

FNGBR_all <- bind_rows(FNGBRtype, Leg_type)

# Join to Ppt and wave data
FNGBRps <- inner_join(FNGBR_all, FNQLeg_Th_FD_Peri_Wave_Slope, by = "Name")

colnames(FNGBRps)

# Rename columns
colnames(FNGBRps)
names(FNGBRps)[names(FNGBRps) == "uWSLmean_R"] <- "uWSLmean"
names(FNGBRps)[names(FNGBRps) == "uWSL100_Ra"] <- "uWSL100"
#TSVps <- rename(TSVps, uWSL100=TSV_uWSL1)
names(FNGBRps)[names(FNGBRps) == "uWSL99_Ras"] <- "uWSL99"
#FNGBRps <- rename(FNGBRps, uWSL99=TSV_uWSL9)
names(FNGBRps)[names(FNGBRps) == "uWSL90_Ras"] <- "uWSL90"
#FNGBRps <- rename(FNGBRps, uWSL90=TSV_uWS_1)
names(FNGBRps)[names(FNGBRps) == "UonrootTme"] <- "UonrootTmean"
#FNGBRps <- rename(FNGBRps, UonrootTmean=TSV_Uonro)
names(FNGBRps)[names(FNGBRps) == "UonrootT10"] <- "UonrootT100"
#FNGBRps <- rename(FNGBRps, UonrootT100=TSV_Uon_1)
#names(FNGBRps)[names(FNGBRps) == "UonrootT99"] <- "UonrootT99"
#FNGBRps <- rename(FNGBRps, UonrootT99=TSV_Uon_2)
#names(FNGBRps)[names(FNGBRps) == "TSV_Uonr_3"] <- "UonrootT90"
#FNGBRps <- rename(FNGBRps, UonrootT90=TSV_Uon_3)
names(FNGBRps)[names(FNGBRps) == "Ubedmean_R"] <- "ubedmean"
#FNGBRps <- rename(FNGBRps,ubedmean=TSV_ubedm)
names(FNGBRps)[names(FNGBRps) == "Ubed100_Ra"] <- "ubed100"
#FNGBRps <- rename(FNGBRps,ubed100=TSV_ubed1)
names(FNGBRps)[names(FNGBRps) == "Ubed99_Ras"] <- "ubed99"
#FNGBRps <- rename(FNGBRps,ubed99=TSV_ubed9)
names(FNGBRps)[names(FNGBRps) == "Ubed90_Ras"] <- "ubed90"
#FNGBRps <- rename(FNGBRps,ubed90=TSV_ube_1)
names(FNGBRps)[names(FNGBRps) == "Tpmean_Ras"] <- "Tpmean"
#FNGBRps <- rename(FNGBRps,Tpmean=TSV_Tpmea)
names(FNGBRps)[names(FNGBRps) == "Tp100_Rast"] <- "Tp100"
#FNGBRps <- rename(FNGBRps,Tp100=TSV_Tp100)
names(FNGBRps)[names(FNGBRps) == "Tp99_Raste"] <- "Tp99"
#FNGBRps <- rename(FNGBRps,Tp99=TSV_Tp99_)
names(FNGBRps)[names(FNGBRps) == "Tp90_Raste"] <- "Tp90"
#FNGBRps <- rename(FNGBRps,Tp90=TSV_Tp90_)
names(FNGBRps)[names(FNGBRps) == "Hsmean_Ras"] <- "Hsmean"
#FNGBRps <- rename(FNGBRps,Hsmean=TSV_Hsmea)
names(FNGBRps)[names(FNGBRps) == "Hs100_Rast"] <- "Hs100"
#FNGBRps <- rename(FNGBRps,Hs100=TSV_Hs100)
names(FNGBRps)[names(FNGBRps) == "Hs99_Raste"] <- "Hs99"
#FNGBRps <- rename(FNGBRps,Hs99=TSV_Hs99_)
names(FNGBRps)[names(FNGBRps) == "Hs98_Raste"] <- "Hs98"
#FNGBRps <- rename(FNGBRps,Hs98=TSV_Hs98_)
names(FNGBRps)[names(FNGBRps) == "Hs97_Raste"] <- "Hs97"
#FNGBRps <- rename(FNGBRps,Hs97=TSV_Hs97_)
names(FNGBRps)[names(FNGBRps) == "Hs96_Raste"] <- "Hs96"
#FNGBRps <- rename(FNGBRps,Hs96=TSV_Hs96_)
names(FNGBRps)[names(FNGBRps) == "FGBR_Hs95_"] <- "Hs95"
#FNGBRps <- rename(FNGBRps,Hs95=TSV_Hs95_)
names(FNGBRps)[names(FNGBRps) == "Hs90_Raste"] <- "Hs90"
#FNGBRps <- rename(FNGBRps,Hs90=TSV_Hs90_)
names(FNGBRps)[names(FNGBRps) == "Hs80_Raste"] <- "Hs80"
#FNGBRps <- rename(FNGBRps,Hs80=TSV_Hs80_)
names(FNGBRps)[names(FNGBRps) == "Hs70_Raste"] <- "Hs70"
#FNGBRps <- rename(FNGBRps,Hs70=TSV_Hs70_)
names(FNGBRps)[names(FNGBRps) == "Efmean_Ras"] <- "Efmean"
#FNGBRps <- rename(FNGBRps,Efmean=TSV_Efmea)
names(FNGBRps)[names(FNGBRps) == "Ef100_Rast"] <- "Ef100"
#FNGBRps <- rename(FNGBRps,Ef100=TSV_Ef100)
names(FNGBRps)[names(FNGBRps) == "Ef99_Raste"] <- "Ef99"
#FNGBRps <- rename(FNGBRps,Ef99=TSV_Ef99_)
names(FNGBRps)[names(FNGBRps) == "Ef90_Raste"] <- "Ef90"
#FNGBRps <- rename(FNGBRps,Ef90=TSV_Ef90_)
names(FNGBRps)[names(FNGBRps) == "Edmean_Ras"] <- "Edmean"
#FNGBRps <- rename(FNGBRps,Edmean=TSV_Edmea)
names(FNGBRps)[names(FNGBRps) == "Ed100_Rast"] <- "Ed100"
#FNGBRps <- rename(FNGBRps,Ed100=TSV_Ed100)
names(FNGBRps)[names(FNGBRps) == "Ed99_Raste"] <- "Ed99"
#FNGBRps <- rename(FNGBRps,Ed99=TSV_Ed99_)
names(FNGBRps)[names(FNGBRps) == "Ed90_Raste"] <- "Ed90"
#FNGBRps <- rename(FNGBRps,Ed90=TSV_Ed90_)
names(FNGBRps)[names(FNGBRps) == "FNQ_Leg_SL"] <- "SLOPE"
#FNGBRps <- rename(FNGBRps,SLOPE=GBR_Sentin)

colnames(FNGBRps)

FNGBRps <- select(FNGBRps, "Name":"Ben_Tot","PeriPt":"SLOPE")

# Make unique names 
# Make ID specific
FNGBRps2 <- FNGBRps %>% dplyr::mutate(Region = as.character("FNGBR_"))

FNGBRps2 <- FNGBRps2 %>% dplyr::mutate(id = row_number())

FNGBRps2 <- FNGBRps2 %>% unite("Pixel", Region:id, remove = FALSE)
colnames(FNGBRps2)
unique(FNGBRps2$Pixel)

FNGBRps3 <- FNGBRps2%>%
  select("Name":"SLOPE","Pixel" )

```

# Summarise by PeriPoint

```{r Summarise by PeriPt}

# Count number of occurrences of each PeriPt and add that to the table

FNQ <- FNGBRps3 %>%
  group_by(PeriPt)%>%
  dplyr::mutate(count = n())

colnames(FNQ)

# Summarise by PeriPt

# Calculate Total coral type points per zone
# when in doubt, add dplyr::

FNGBR_TotPts <- FNQ %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotPts = count*100, TotBrpts = sum(Branching), TotMapts = sum(Massive), TotPpts = sum(Plate),  TotMix = sum(Mixed), TotOthPts = sum(CT_Oth))

colnames(FNGBR_TotPts)


# Calculate fractional amount of coral types

FNGBR_TotPts <- FNGBR_TotPts%>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(BoverTot = (TotBrpts/TotPts), MoverTot = (TotMapts/TotPts), PoverTot = (TotPpts/TotPts), MixoverTot = (TotMix/TotPts))

colnames(FNGBR_TotPts)

# Determine Dominant Coral Type per zone

FNGBR_DomPerZone <- mutate(FNGBR_TotPts, DomZone = ifelse((BoverTot == 0) & (MoverTot == 0) & (PoverTot == 0) & (MixoverTot == 0), "None",
                                                           ifelse(((BoverTot) > (MoverTot)) & ((BoverTot) > (PoverTot)) & ((BoverTot) > (MixoverTot)),  "Branching",                                               
        ifelse(((MoverTot) > (BoverTot)) & ((MoverTot) > (PoverTot)) & ((MoverTot) > (MixoverTot)), "Massive", 
               ifelse(((PoverTot) > (BoverTot)) & ((PoverTot) > (MoverTot)) & ((PoverTot) > (MixoverTot)), "Plate", 
                      "Mixed")))))

unique(FNGBR_DomPerZone$DomZone)

colnames(FNGBR_DomPerZone)


# check what columns are there
FDom <- FNGBR_DomPerZone%>%
  select("Pixel", "PeriPt":"P_Long","count", "Branching":"Ben_Tot", "TotPts": "MixoverTot")

# Summarise Benthic type per Perimeter Point
FNGBR_DomPerZone2 <- FNGBR_DomPerZone %>%
  dplyr::group_by(PeriPt)%>%
  dplyr::mutate(TotHC = sum(HC), TotSC = sum(SC), TotSD = sum(SD),  TotRB = sum(RB), TotRK = sum(RK), TotAL = sum(AL), TotOT = sum(OT), TotSG = sum(SG))

colnames(FNGBR_DomPerZone2)

# select summarised columns
FNGBR_DomPerZone2 <- FNGBR_DomPerZone2 %>%
  select("Pixel", "P_Lat":"P_Long","count","TotHC":"TotSG", "TotPts": "DomZone", "uWSLmean":"SLOPE")

# remove duplicated Ppt rows

FNGBRZone <- FNGBR_DomPerZone2 %>% distinct(PeriPt, .keep_all = TRUE)

colnames(FNGBRZone)

# Join wave parameters

#  Save
FNGBRZone <- write.csv(FNGBRZone, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/PerRegion2021/FNGBR_Ppt_waves_summary.csv")

```

# Fix SGBR coordinates

```{r}

names(MKY_Theiss_peri_int)[names(MKY_Theiss_peri_int) == "FID_MKY_pe"] <- "PeriPt"

# why am I not just using this.....????
names(MKY_Theiss_FD_int)[names(MKY_Theiss_FD_int) == "Name"] <- "image_name"

names(MKY_Theiss_FD_int)[names(MKY_Theiss_FD_int) == "Image"] <- "Name"

MKY_probs <- MKY_Theiss_FD_int%>%
  select("Name","PeriPt", "P_Lat":"P_Long")

```
 
# Bind all GBR together

```{r}
# Read in files and check col names
CCMR <- CCMR_Ppt_waves_summary
MKY <- MKY_Ppt_waves_summary
TSV <- TSV_Ppt_waves_summary
FNGBR <- FNGBR_Ppt_waves_summary

colnames(FNGBR)

WholeGBR <- bind_rows(CCMR, MKY, TSV, FNGBR)

# write to file

WholeGBR <- write.csv(WholeGBR, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/CoralTypeMapping/Mitch2021/PerRegion2021/WholeGBR_Ppt_waves_summary.csv")


```

# Now try with new ReefCloud Data

```{r Reefcloud - New - all classes}
# Read in file
colnames(GBR_ReefCloud_export_20210331)

unique(GBR_ReefCloud_export_20210331$human_classification) # No human annotations

tail(GBR_ReefCloud_export_20210331)

nrow(GBR_ReefCloud_export_20210331) # 11685960
nrow(GBR_ReefCloud_export_20210331)/50 # 233719.2
unique(GBR_ReefCloud_export_20210331$collection_method)

# Try to find duplicates
ReefD <- GBR_ReefCloud_export_20210331%>%
  select("image_name", "point_num")

RC_duplicated <- ReefD[duplicated(ReefD),]


# Proceed to processing
ReefC <- GBR_ReefCloud_export_20210331 %>%
  select("image_name":"machine_classification")
nrow(ReefC)# 11685960

# write to file

ReefC <- write.csv(ReefC, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/ReefCloud/ReefC_20210331.csv")

ReefC <- ReefC_20210331

unique(ReefC$machine_classification)

# Sum the annotation classes per image
ReefC_sum2 <- ReefC%>%
  dplyr::count(image_name, machine_classification)%>%
  tidyr::spread(key = machine_classification, value = n)

  ReefC_sum2 <- ReefC_sum2 %>% replace(is.na(.), 0)
  
  # write to file

ReefC_sum2 <- write.csv(ReefC_sum2, file = "C:/Users/uqekovac/Documents/R/Coding/GBRBenthic2020/ReefCloud/ReefC_summary_202100331.csv")

Reef <- ReefC_summary_202100331

colnames(Reef)
unique(Reef$V1)


```



# Summarise for CT
```{r}

Reeftype <-
  Reef %>%
  rowwise()%>%
  mutate( 
    Branching = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + #`ACR-HIP-B` +
                   `BRA_OTH` + #`BRA_OTH-B` + 
                   `POCI` + `POCI-B` + `POR-BRA` #+ #`POR-BRA-B`
                   ),
    Plate = (`ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + #`TFP_RDG-B` + 
               `TFP_RND_Al` #+ `TFP_RND-B`
             ),
    Massive = (`BRA_DIG_Ac` + #`BRA_DIG_B` +
                 `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + #`MASEoth-B` +
                 `POR-ENC` + #`POR-ENC-B` + 
                 `POR-MASS` #+ `POR-MAS-B`
               ),
    Mixed = (`ACR-OTH` + #`ACR-OTH-B` + 
               `OTH-HC` #+ `OTH-HC-B`
             ),
    CT_Oth = (`ALC-SF` + `ALC-SF-B` + `GORG`  + #`GORG-B` +
                `MINV_COTS` + `MOB-INV` + `OTH-SF` + #`OTH-SF-B` + 
                `OTH-SINV` + `Sand` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE` + `ALG_OTH` + `BMA_sand` + `CAL_CCA_DC` + `CAL_CCA_RB` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` + `EAM_DHC` + `EAM_RB` + #`Lobph` +
                `MACR_Cal_H` + #`MAECBS` +
                `Pad` #+ `Turbin` + `Seagrass`
                ))
 

   
Reeftype <-
  Reeftype %>%
  rowwise()%>%
  mutate( 
    CT_Tot = (`Branching` + `Massive` + `Plate` + `Mixed` + `CT_Oth`)) 

colnames(Reeftype)
unique(Reeftype$CT_Tot)

# Group according to Benthic Type
FNGBRtype <-
  FNGBRtype %>%
  rowwise()%>%
  mutate( 
    HC = (`ACR-BRA` + `ACR-BRA-B` + `ACR-HIP` + `ACR-HIP-B` + `BRA_OTH` + `BRA_OTH-B` + `POCI` + `POCI-B` + `POR-BRA` + `POR-BRA-B` + `ACR-PE` + `ACR-PE-B` + `BRA_TAB-Ac` + `BRA_TAB-B` + `TFP_RDG_Al` + `TFP_RDG-B` + `TFP_RND_Al` + `TFP_RND-B` + `BRA_DIG_Ac` + `BRA_DIG_B` + `FAV-MUS` + `FAV-MUS-B` + `MASE_OTH` + `MASEoth-B` + `POR-ENC` + `POR-ENC-B` + `POR-MASS` + `POR-MAS-B` + `ACR-OTH` + `ACR-OTH-B` + `OTH-HC` + `OTH-HC-B`),
    SC = (`ALC-SF` + `ALC-SF-B` + `GORG`  + `GORG-B` + `OTH-SF` + `OTH-SF-B`),
    SD = (`Sand` + `BMA_sand`),
    RB = (`CAL_CCA_RB` + `EAM_RB`),
    RK = (`CAL_CCA_DC` + `EAM_DHC`),
    AL = (`ALG_OTH` + `Caul` + `Chlor` + `Cya_spe` + `Dicsp` +  `Lobph` + `MACR_Cal_H` + `MAECBS` + `Pad` + `Turbin`),
    OT = (`MINV_COTS` + `MOB-INV`  + `OTH-SINV` + `Other` + `TAPE` + `Unc` + `Unk` + `WATE`),
    SG = (`Seagrass`))
    
FNGBRtype <-
  FNGBRtype %>%
  rowwise()%>%
  mutate( 
    Ben_Tot = (`HC` + `SC` + `SD` + `RB` + `RK` + `AL` + `OT` + `SG`)) 

colnames(FNGBRtype)
unique(FNGBRtype$Ben_Tot)

```

